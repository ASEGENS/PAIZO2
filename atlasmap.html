<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Interactive</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100vh; /* Hauteur de la carte */
            width: 100%; /* Largeur de la carte */
        }
        .custom-div-icon {
            background: transparent;
            border: none;
        }
        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }
        .legend h4 {
            margin-top: 0;
        }
        .legend-label {
            display: flex;
            align-items: center;
        }
        .legend-checkbox {
            margin-right: 5px;
        }
        .legend-color {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 5px;
            border: 2px solid white;
        }
        .shape-circle {
            border-radius: 50%;
        }
        .shape-square {
            border-radius: 0;
        }
        .shape-triangle {
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 24px solid;
            background: transparent;
        }
        .shape-star {
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        .shape-diamond {
            width: 16px;
            height: 16px;
            transform: rotate(45deg);
        }
        .shape-pentagon {
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0 38%);
        }
        .shape-hexagon {
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
        }
        .shape-octagon {
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
        }
    </style>
</head>
<body>    
    <!-- Map Section -->
    <section class="map-section">
        <div id="map"></div>
    </section>   

    <!-- Modal -->
    <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="infoModalLabel">Détails</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="modalContent">
                        <!-- Contenu dynamique -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser la carte
            const map = L.map('map', {
                crs: L.CRS.Simple,
                minZoom: -2, // Niveau de zoom minimum ajusté
                maxZoom: 2,  // Niveau de zoom maximum
            });
        
            // Définir les dimensions de l'image
            const w = 7516, h = 3848; // Largeur et hauteur de l'image
            const imageUrl = 'img/MAP/Vienia_Atlas.png'; // Chemin vers l'image
        
            // Définir les coins de l'image dans le système de coordonnées
            const southWest = map.unproject([0, h], map.getMaxZoom() - 1);
            const northEast = map.unproject([w, 0], map.getMaxZoom() - 1);
            const bounds = new L.LatLngBounds(southWest, northEast);
        
            // Ajouter l'image à la carte
            L.imageOverlay(imageUrl, bounds).addTo(map);
        
            // Adapter la vue à l'image
            map.fitBounds(bounds);
        
            // Définir les limites maximales de dézoom
            map.setMaxBounds(bounds);
        
            // Fonction pour créer une icône personnalisée
            function createCustomIcon(color, shape, borderColor = 'white') {
                return L.divIcon({
                    className: `custom-div-icon shape-${shape}`,
                    html: `<div style="background-color: ${color}; border: 2px solid ${borderColor};"></div>`,
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });
            }
        
            const markers = {
                'capitales': [],
                'guildes': [],
                'mers': [],
                'golfs': [],
                'océans': [],
                'villes': [],
                'monuments': [],
                'incomplets': []
            };
        
            // Lire les données CSV et ajouter les marqueurs
            Papa.parse('atlasmap.csv', {
                download: true,
                header: true,
                complete: function(results) {
                    const data = results.data;
                    data.forEach(function(row, index) {
                        const lat = parseFloat(row.lat);
                        const lng = parseFloat(row.lng);
                        const title = row.nom;
                        const description = row.description || "";
                        const Pays = row.Pays || "";
                        const Politique = row.Politique || "";
                        const Population = row.Population || "";
                        const descriptionShort = description.length > 100 ? description.substring(0, 100) + '...' : description;
        
                        const color = row.Couleur || '#3388ff'; // Utiliser une couleur par défaut si non spécifié
                        const borderColor = description ? 'black' : 'red'; // Couleur de bordure en fonction de la description
                        let shape;
        
                        if (color === '#FCDC12') {
                            shape = 'circle';
                            markers['capitales'].push(marker);
                        } else if (color === '#090E19') {
                            shape = 'square';
                            markers['guildes'].push(marker);
                        } else if (color === '#1c5fa6') {
                            shape = 'diamond';
                            markers['mers'].push(marker);
                        } else if (color === '#2b839e') {
                            shape = 'pentagon';
                            markers['golfs'].push(marker);
                        } else if (color === '#0000FF') {
                            shape = 'hexagon';
                            markers['océans'].push(marker);
                        } else if (color === '#F0F0F2') {
                            shape = 'triangle';
                            markers['villes'].push(marker);
                        } else if (color === '#3B2077') {
                            shape = 'star';
                            markers['monuments'].push(marker);
                        }

                        const customIcon = createCustomIcon(color, shape, borderColor);
        
                        const marker = L.marker(map.unproject([lat, lng], map.getMaxZoom() - 1), { icon: customIcon })
                            .bindPopup(`
                                                               <b>${title}</b><br>${Pays}<br><br>${Politique}<br><br>${Population}<br><br>${descriptionShort}<br>
                                <button type="button" class="btn btn-primary btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#infoModal" data-index="${index}">
                                    Plus d'infos
                                </button>
                            `);
        
                        marker.on('click', function() {
                            const modalContent = document.getElementById('modalContent');
                            modalContent.innerHTML = `
                                <h5>${row.nom}</h5>
                                ${row.image ? `<img src="img/MAP/${row.image}" alt="${row.nom}" class="img-fluid mb-3">` : ''}
                                ${row.Pays ? `<p><strong>Pays:</strong> ${row.Pays}</p>` : ''}
                                ${row.description ? `<p><strong>Description:</strong> ${row.description}</p>` : ''}
                                ${row.Politique ? `<p><strong>Politique:</strong> ${row.Politique}</p>` : ''}
                                ${row.Population ? `<p><strong>Population:</strong> ${row.Population}</p>` : ''}
                                ${row.capital ? `<p><strong>Capital:</strong> ${row.capital}</p>` : ''}
                                ${row.Monument ? `<p><strong>Monument:</strong> ${row.Monument}</p>` : ''}
                                ${row.religion ? `<p><strong>Religion:</strong> ${row.religion}</p>` : ''}
                            `;
                        });

                        // Ajouter le marqueur à la carte et à la liste des marqueurs par catégorie
                        marker.addTo(map);

                        if (!description) {
                            markers['incomplets'].push(marker);
                        }
                    });
                }
            });
        
            // Ajouter une légende
            const legend = L.control({ position: 'topleft' });
        
            legend.onAdd = function(map) {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <h4>Légende</h4>
                    <div class="legend-label">
                        <input type="checkbox" class="legend-checkbox" checked id="filter-capitales">
                        <div class="legend-color shape-circle" style="background-color: #FCDC12;"></div> Capitales
                    </div>
                    <div class="legend-label">
                        <input type="checkbox" class="legend-checkbox" checked id="filter-guildes">
                        <div class="legend-color shape-square" style="background-color: #090E19;"></div> Guildes
                    </div>
                    <div class="legend-label">
                        <input type="checkbox" class="legend-checkbox" checked id="filter-villes">
                        <div class="legend-color shape-triangle" style="background-color: #F0F0F2;"></div> Villes
                    </div>
                    <div class="legend-label">
                        <input type="checkbox" class="legend-checkbox" checked id="filter-océans">
                        <div class="legend-color shape-hexagon" style="background-color: #0000FF;"></div> Océans
                    </div>
                    <div class="legend-label">
                        <input type="checkbox" class="legend-checkbox" checked id="filter-mers">
                        <div class="legend-color shape-diamond" style="background-color: #1c5fa6;"></div> Mers
                    </div>
                    <div class="legend-label">
                        <input type="checkbox" class="legend-checkbox" checked id="filter-golfs">
                        <div class="legend-color shape-pentagon" style="background-color: #2b839e;"></div> Golfs
                    </div>
                    <div class="legend-label">
                        <input type="checkbox" class="legend-checkbox" checked id="filter-monuments">
                        <div class="legend-color shape-star" style="background-color: #3B2077;"></div> Monuments
                    </div>
                    <div class="legend-label">
                        <input type="checkbox" class="legend-checkbox" checked id="filter-incomplets">
                        <div class="legend-color shape-octagon" style="background-color: #cccccc; border: 2px solid red;"></div> Incomplet
                    </div>
                `;
                return div;
            };
        
            legend.addTo(map);
        
            // Fonction pour gérer les filtres
            function updateMarkers() {
                const showCapitales = document.getElementById('filter-capitales').checked;
                const showGuildes = document.getElementById('filter-guildes').checked;
                const showMers = document.getElementById('filter-mers').checked;
                const showGolfs = document.getElementById('filter-golfs').checked;
                const showOceans = document.getElementById('filter-océans').checked;
                const showVilles = document.getElementById('filter-villes').checked;
                const showMonuments = document.getElementById('filter-monuments').checked;
                const showIncomplets = document.getElementById('filter-incomplets').checked;
        
                markers['capitales'].forEach(marker => {
                    if (showCapitales) {
                        marker.addTo(map);
                    } else {
                        map.removeLayer(marker);
                    }
                });
        
                markers['guildes'].forEach(marker => {
                    if (showGuildes) {
                        marker.addTo(map);
                    } else {
                        map.removeLayer(marker);
                    }
                });
        
                markers['mers'].forEach(marker => {
                    if (showMers) {
                        marker.addTo(map);
                    } else {
                        map.removeLayer(marker);
                    }
                });
        
                markers['golfs'].forEach(marker => {
                    if (showGolfs) {
                        marker.addTo(map);
                    } else {
                        map.removeLayer(marker);
                    }
                });
        
                markers['océans'].forEach(marker => {
                    if (showOceans) {
                        marker.addTo(map);
                    } else {
                        map.removeLayer(marker);
                    }
                });
        
                markers['villes'].forEach(marker => {
                    if (showVilles) {
                        marker.addTo(map);
                    } else {
                        map.removeLayer(marker);
                    }
                });

                markers['monuments'].forEach(marker => {
                    if (showMonuments) {
                        marker.addTo(map);
                    } else {
                        map.removeLayer(marker);
                    }
                });

                markers['incomplets'].forEach(marker => {
                    if (showIncomplets) {
                        marker.addTo(map);
                    } else {
                        map.removeLayer(marker);
                    }
                });
            }
        
            // Ajouter des écouteurs d'événements pour les filtres
            document.getElementById('filter-capitales').addEventListener('change', updateMarkers);
            document.getElementById('filter-guildes').addEventListener('change', updateMarkers);
            document.getElementById('filter-mers').addEventListener('change', updateMarkers);
            document.getElementById('filter-golfs').addEventListener('change', updateMarkers);
            document.getElementById('filter-océans').addEventListener('change', updateMarkers);
            document.getElementById('filter-villes').addEventListener('change', updateMarkers);
            document.getElementById('filter-monuments').addEventListener('change', updateMarkers);
            document.getElementById('filter-incomplets').addEventListener('change', updateMarkers);
        });
    </script>
</body>
</html>

